<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Css Display Tool</title>
  <link href="1.1-css-selector/1.1-css-selector.css" rel="stylesheet" type="text/css">
  <script src="../vue.js"></script>
</head>
<body>
<div id="app" class="operate-bar">
  <h3>
    CSS Display Tool
    <img class="btn-reset btn" @click="resetStyle" src="1.1-css-selector/imgs/reset.png" width="14">
  </h3>
  <input class="input-selector" v-model="selectorName" type="text"/>
  <button @click="highlightSelected">show</button>
  <div class="travels">
    <div class="travel-item btn" v-for="(travel, index) in travels" @click="spaceTravel(index)">{{ index + 1 }}: {{
      travel.selectorName }}
    </div>
  </div>
  <selector-basket :selectors="selectors"></selector-basket>
</div>
<div class="display">
  <div>
    div
    <p>div > p1</p>
    <p>div > p2</p>
    <ul>
      ul
      <li>
        div > ul > li1
        <p> div > ul > li1 > p1 </p>
        <p> div > ul > li1 > p2 </p>
      </li>
      <li>div > ul > li2</li>
      <li>div > ul > li3</li>
      <li>div > ul > li4</li>
    </ul>
    <p>div > p3</p>
    <p>div > p4</p>
  </div>
  <p>p1</p>
  <p>p2</p>
</div>
<script>
  const resetStyle = () => {
    document.querySelectorAll('.display *').forEach(dom => {
      dom.style = {}
    })
  }

  const markSelected = (selectorName) => {
    document.querySelectorAll(`.display ${selectorName}`).forEach(dom => {
      dom.style.color = 'red'
      dom.style.backgroundColor = 'lightblue'
      // dom.style.opacity = dom.style.opacity ? +dom.style.opacity + .2 : .2
    })
  }

  const SelectorBasket = {
    props: ['selectors'],
    template: `
      <div>
        <div v-for="(selector, index) in selectors">
          <button @click="markSelected(selector)">choose</button>
          <li style="display: inline;">{{ selector }}</li>
        </div>
      </div>
    `,
    methods: {
      markSelected (selector) {
        markSelected(selector)
      }
    }
  }

  const vm = new Vue({
    el: '#app',
    components: { SelectorBasket },
    data () {
      return {
        selectorName: '',
        travels: [],
        travel: {
          selectorName: '',
          travels: []
        },
        selectors: [
          '.name',
          'div+p',
          'p~ul',
        ]
      }
    },
    methods: {
      highlightSelected () {
        try {
          if (this.selectorName.match(/^\s*$/)) {
            throw new Error()
          }
          const selectorName = this.selectorName
          markSelected(selectorName)
          this.travels.push({ selectorName })

          this.selectorName = ''
        } catch (e) {
          alert('invalid selector!')
        }
      },
      spaceTravel (index) {
        resetStyle()
        this.travels.some((travel, i) => {
          markSelected(travel.selectorName)
          return i >= index
        })
      },
      resetStyle () {
        this.selectorName = ''
        this.travels = []
        resetStyle()
      }
    },
    created () {
      document.onkeypress = (e) => {
        e.key === 'Enter' && this.highlightSelected()
      }
    }
  })
</script>
</body>
</html>